# Load required modules
LoadModule slotmem_shm_module modules/mod_slotmem_shm.so
LoadModule ssl_module modules/mod_ssl.so

# Proxy modules
LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_fcgi_module modules/mod_proxy_fcgi.so
LoadModule proxy_http_module modules/mod_proxy_http.so
LoadModule proxy_balancer_module modules/mod_proxy_balancer.so

# Essential modules for PrestaShop
LoadModule rewrite_module modules/mod_rewrite.so
LoadModule headers_module modules/mod_headers.so
LoadModule expires_module modules/mod_expires.so
LoadModule deflate_module modules/mod_deflate.so
LoadModule filter_module modules/mod_filter.so
LoadModule mime_module modules/mod_mime.so
LoadModule setenvif_module modules/mod_setenvif.so

# Server name
ServerName webserver

# Security settings
ServerTokens Prod
ServerSignature Off
TraceEnable Off

# Proxy settings
ProxyRequests Off
ProxyPreserveHost On

<Proxy *>
    Require all granted
</Proxy>

# Timeout settings for PHP-FPM
Timeout 300
ProxyTimeout 300

# Set environment variables for PHP-FPM
<IfModule mod_proxy_fcgi.c>
    # Enable connection reuse to PHP-FPM
    SetEnv proxy-fcgi-pathinfo unescape
    SetEnv proxy-initial-not-pooled 1
</IfModule>

# Compression
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript
    AddOutputFilterByType DEFLATE application/xml application/xhtml+xml application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript application/x-javascript
    AddOutputFilterByType DEFLATE application/json
    AddOutputFilterByType DEFLATE image/svg+xml
</IfModule>

# Security Headers
<IfModule mod_headers.c>
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "no-referrer-when-downgrade"
    
    # Remove sensitive headers
    Header unset X-Powered-By
    Header unset Server
</IfModule>

# File upload size
LimitRequestBody 104857600

# Keep-Alive settings
KeepAlive On
MaxKeepAliveRequests 100
KeepAliveTimeout 5