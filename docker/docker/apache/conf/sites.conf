# ── HTTP (nginx handles TLS termination upstream) ─────────────────────────────
<VirtualHost *:80>
    ServerName   DOMAIN_VAR
    DocumentRoot /var/www/html

    <If "%{ENV:ENV_PROFILE} != 'local'">
        RewriteEngine On
        RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]
    </If>

    SetEnvIf X-Forwarded-Proto "https" HTTPS=on

    <Directory /var/www/html>
        DirectoryIndex index.php index.html
        AllowOverride All
        Options -Indexes
        Require all granted
        <FilesMatch \.php$>
            SetHandler "proxy:fcgi://php-fpm:9000/"
        </FilesMatch>
    </Directory>

    ErrorLog  /var/log/apache2/DOMAIN_VAR.error.log
    CustomLog /var/log/apache2/DOMAIN_VAR.access.log combined
</VirtualHost>